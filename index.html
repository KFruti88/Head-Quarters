<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>618 Tactical: Full Intelligence Report</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&display=swap');
        body { background: #000; color: #888; font-family: 'JetBrains Mono', monospace; font-size: 11px; }
        .f1-text { color: #FF5F00; }
        .f2-text { color: #C41E3A; }
        .f1-border { border-color: #FF5F00; }
        .f2-border { border-color: #C41E3A; }
        .data-card { border: 1px solid #222; padding: 10px; margin-bottom: 10px; border-left: 4px solid; }
        .header { font-size: 4rem; font-weight: 800; text-transform: uppercase; font-style: italic; }
    </style>
</head>
<body class="p-6">
    <div class="grid grid-cols-2 gap-10">
        
        <div>
            <h1 class="header f1-text mb-8">FARM 01</h1>
            <div id="f1-money" class="text-4xl font-bold f1-text mb-10">$0.00</div>
            
            <h2 class="text-xl font-bold mb-4 underline">DETAILED FLEET INVENTORY</h2>
            <div id="f1-fleet" class="space-y-2"></div>

            <h2 class="text-xl font-bold mt-10 mb-4 underline">PRODUCTION & STORAGE</h2>
            <div id="f1-production" class="space-y-2"></div>
        </div>

        <div>
            <h1 class="header f2-text mb-8">FARM 02</h1>
            <div id="f2-money" class="text-4xl font-bold f2-text mb-10">$0.00</div>
            
            <h2 class="text-xl font-bold mb-4 underline">DETAILED FLEET INVENTORY</h2>
            <div id="f2-fleet" class="space-y-2"></div>

            <h2 class="text-xl font-bold mt-10 mb-4 underline">PRODUCTION & STORAGE</h2>
            <div id="f2-production" class="space-y-2"></div>
        </div>
    </div>

    <script>
        async function buildFullReport() {
            const ts = new Date().getTime();
            const fetchXml = f => fetch(`${f}?v=${ts}`).then(r => r.text()).then(t => new DOMParser().parseFromString(t, "text/xml"));

            try {
                const [farms, vehicles, placeables] = await Promise.all([
                    fetchXml('farms.xml'), fetchXml('vehicles.xml'), fetchXml('placeables.xml')
                ]);

                // 1. FINANCES
                Array.from(farms.getElementsByTagName("farm")).forEach(f => {
                    const id = f.getAttribute("farmId");
                    const money = parseInt(f.getAttribute("money")).toLocaleString();
                    if(document.getElementById(`f${id}-money`)) document.getElementById(`f${id}-money`).innerText = `$${money}`;
                });

                // 2. FLEET (NON-COMPACT - LIST EVERY ITEM)
                Array.from(vehicles.getElementsByTagName("vehicle")).forEach(v => {
                    const fId = v.getAttribute("farmId");
                    if(fId != "1" && fId != "2") return;
                    const name = v.getAttribute("filename").split('/').pop();
                    const dmg = (parseFloat(v.querySelector("component")?.getAttribute("damage") || 0) * 100).toFixed(2);
                    const fuel = Math.round(v.querySelector("consumer[type='fuel']")?.getAttribute("usage") || 0);

                    const html = `<div class="data-card ${fId=='1'?'f1-border':'f2-border'}">
                        <strong>${name}</strong><br>
                        > CONDITION: ${100-dmg}% | FUEL: ${fuel}L
                    </div>`;
                    document.getElementById(`f${fId}-fleet`).innerHTML += html;
                });

                // 3. PRODUCTION (NON-COMPACT - LIST EVERY STORAGE ITEM)
                Array.from(placeables.getElementsByTagName("placeable")).forEach(p => {
                    const fId = p.getAttribute("farmId");
                    if(fId != "1" && fId != "2") return;
                    const name = p.getAttribute("filename").split('/').pop();
                    
                    let storageList = "";
                    Array.from(p.getElementsByTagName("node")).forEach(n => {
                        const level = Math.round(parseFloat(n.getAttribute("fillLevel") || 0));
                        if(level > 0) storageList += `<br>-- ${n.getAttribute("fillType")}: ${level}L`;
                    });

                    if(storageList) {
                        const html = `<div class="data-card ${fId=='1'?'f1-border':'f2-border'}">
                            <strong>${name}</strong>${storageList}
                        </div>`;
                        document.getElementById(`f${fId}-production`).innerHTML += html;
                    }
                });

            } catch (e) { console.error("Report System Error", e); }
        }
        buildFullReport();
    </script>
</body>
</html>
