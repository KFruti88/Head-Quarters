<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>618 Tactical Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&display=swap');
        
        :root { 
            --f1: #FF5F00; 
            --f2: #C41E3A; 
            --glass: rgba(15, 15, 15, 0.7);
            --glow: rgba(255, 255, 255, 0.05);
        }

        body { 
            background: radial-gradient(circle at top right, #1a1a1a, #000); 
            color: #ccc; 
            font-family: 'JetBrains Mono', monospace; 
            font-size: 11px;
            min-height: 100vh;
        }

        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8), inset 0 0 10px var(--glow);
            border-radius: 8px;
        }

        .f1-text { color: var(--f1); text-shadow: 0 0 8px rgba(255, 95, 0, 0.4); }
        .f1-border { border-color: var(--f1); }
        .f2-text { color: var(--f2); text-shadow: 0 0 8px rgba(196, 30, 58, 0.4); }
        .f2-border { border-color: var(--f2); }

        .header-box { padding: 12px; min-width: 280px; }
        .scroll-box { height: 400px; overflow-y: auto; padding: 15px; background: rgba(0, 0, 0, 0.4); }

        .card-inner { 
            background: rgba(255, 255, 255, 0.03); 
            padding: 10px; 
            margin-bottom: 10px; 
            border-radius: 4px; 
            border-left: 4px solid;
            transition: transform 0.2s ease;
        }
        .card-inner:hover { transform: translateX(5px); background: rgba(255, 255, 255, 0.07); }

        .status-dot { 
            height: 12px; width: 12px; border-radius: 50%; 
            display: inline-block; margin-right: 8px; 
            box-shadow: 0 0 15px #0f0; 
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .trophy-earned { opacity: 0.8; border-left: 4px solid #00ff00 !important; background: rgba(0, 255, 0, 0.05); }
        .pinned-contract { background: rgba(234, 179, 8, 0.1); border-left: 4px solid #eab308; margin-bottom: 15px; }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
    </style>
</head>
<body class="p-8">

    <header class="flex justify-between items-start mb-10 border-b border-gray-800 pb-8">
        <div class="flex flex-col">
            <div class="flex items-center">
                <span class="status-dot bg-green-500"></span>
                <b class="text-4xl text-white uppercase font-black italic tracking-tighter">618 TACTICAL</b>
            </div>
            <span class="text-xs text-blue-400 font-bold tracking-widest mt-1 uppercase">Operational Status: Secure</span>
        </div>

        <div class="flex gap-6">
            <div class="header-box glass-panel f1-border">
                <div class="f1-text font-black text-xs uppercase tracking-widest">F1: WEREWOLF (ET)</div>
                <div class="text-white text-4xl font-black" id="f1-head-money">$0</div>
                <div id="time-gnv" class="text-[11px] text-gray-400 font-bold mt-1">ET: --:--</div>
                <div id="weather-gnv" class="text-[11px] text-gray-500">TEMP: --Â°F</div>
            </div>
            <div class="header-box glass-panel f2-border">
                <div class="f2-text font-black text-xs uppercase tracking-widest">F2: RAY (CT)</div>
                <div class="text-white text-4xl font-black" id="f2-head-money">$0</div>
                <div id="time-flora" class="text-[11px] text-gray-400 font-bold mt-1">CT: --:--</div>
                <div id="weather-flora" class="text-[11px] text-gray-500">TEMP: --Â°F</div>
            </div>
            <div class="header-box glass-panel border-blue-500">
                <div class="text-blue-400 font-black text-xs uppercase tracking-widest">Game Sync</div>
                <div id="game-time" class="text-white text-4xl font-black">00:00</div>
                <div id="game-date" class="text-[11px] text-gray-400 font-bold italic">Day 1 | Sunny</div>
            </div>
        </div>
        <div class="text-right">
            <div class="text-gray-500 text-xs font-bold uppercase tracking-widest">Collectibles</div>
            <div class="text-6xl font-black text-yellow-500 drop-shadow-lg"><span id="coll-found">0</span>/50</div>
        </div>
    </header>

    <div class="grid grid-cols-4 gap-6 mb-8">
        <div class="glass-panel f1-border"><h3 class="f1-text font-black p-3 border-b border-gray-800 text-center uppercase">Werewolf Achievements</h3><div id="f1-trophies" class="scroll-box"></div></div>
        <div class="glass-panel f1-border"><h3 class="f1-text font-black p-3 border-b border-gray-800 text-center uppercase">Werewolf Production</h3><div id="f1-prod" class="scroll-box"></div></div>
        <div class="glass-panel f2-border"><h3 class="f2-text font-black p-3 border-b border-gray-800 text-center uppercase">Ray Achievements</h3><div id="f2-trophies" class="scroll-box"></div></div>
        <div class="glass-panel f2-border"><h3 class="f2-text font-black p-3 border-b border-gray-800 text-center uppercase">Ray Production</h3><div id="f2-prod" class="scroll-box"></div></div>
    </div>

    <div class="grid grid-cols-4 gap-6 mb-8">
        <div class="glass-panel f1-border"><h3 class="f1-text font-bold p-3 border-b border-gray-800 uppercase">F1 Fleet <span id="f1-v-count">0</span></h3><div id="f1-fleet" class="scroll-box"></div></div>
        <div class="glass-panel f1-border"><h3 class="f1-text font-bold p-3 border-b border-gray-800 uppercase">F1 Attach</h3><div id="f1-attach" class="scroll-box"></div></div>
        <div class="glass-panel f1-border"><h3 class="f1-text font-bold p-3 border-b border-gray-800 uppercase">F1 Pallets</h3><div id="f1-pallets" class="scroll-box"></div></div>
        <div class="glass-panel f1-border"><h3 class="f1-text font-bold p-3 border-b border-gray-800 uppercase">F1 Fields</h3><div id="f1-fields" class="scroll-box"></div></div>
    </div>

    <div class="grid grid-cols-4 gap-6 mb-8">
        <div class="glass-panel f2-border"><h3 class="f2-text font-bold p-3 border-b border-gray-800 uppercase">F2 Fleet <span id="f2-v-count">0</span></h3><div id="f2-fleet" class="scroll-box"></div></div>
        <div class="glass-panel f2-border"><h3 class="f2-text font-bold p-3 border-b border-gray-800 uppercase">F2 Attach</h3><div id="f2-attach" class="scroll-box"></div></div>
        <div class="glass-panel f2-border"><h3 class="f2-text font-bold p-3 border-b border-gray-800 uppercase">F2 Pallets</h3><div id="f2-pallets" class="scroll-box"></div></div>
        <div class="glass-panel f2-border"><h3 class="f2-text font-bold p-3 border-b border-gray-800 uppercase">F2 Fields</h3><div id="f2-fields" class="scroll-box"></div></div>
    </div>

    <div class="grid grid-cols-3 gap-6 mb-8">
        <div class="glass-panel border-gray-700"><h3 class="text-white font-bold p-3 border-b border-gray-800 uppercase">Active Missions</h3><div id="missions" class="scroll-box"></div></div>
        <div class="glass-panel border-gray-700"><h3 class="text-yellow-600 font-bold p-3 border-b border-gray-800 uppercase">Market Stocks</h3><div id="stocks" class="scroll-box"></div></div>
        <div class="glass-panel border-gray-700"><h3 class="text-purple-600 font-bold p-3 border-b border-gray-800 uppercase">Coordinate Uplink</h3><div id="all-coll" class="scroll-box"></div></div>
    </div>

    <div class="grid grid-cols-2 gap-6">
        <div class="glass-panel f1-border"><h3 class="f1-text font-black p-4 text-lg italic uppercase tracking-tighter">Werewolf Livestock & Feed</h3><div id="f1-animals" class="scroll-box"></div></div>
        <div class="glass-panel f2-border"><h3 class="f2-text font-black p-4 text-lg italic uppercase tracking-tighter">Ray Livestock & Feed</h3><div id="f2-animals" class="scroll-box"></div></div>
    </div>

    <script>
        const fillLabels = {
            'SOUPCANSBEETROOT': 'Beetroot Soup', 'BEETROOT': 'Beetroot',
            'SOUPCANSPOTATO': 'Potato Soup', 'POTATO': 'Potato',
            'SOUPCANSCARROTS': 'Carrot Soup', 'CARROT': 'Carrot',
            'TMR': 'TMR', 'SILAGE': 'Silage', 'DRYGRASS_WINDROW': 'Hay', 'GRASS_WINDROW': 'Grass',
            'MILK': 'Milk', 'LIQUIDMANURE': 'Slurry', 'MANURE': 'Manure', 'EGG': 'Eggs'
        };

        function cleanLabel(raw) { return fillLabels[raw] || raw; }

        const trophyList = [
            { name: "Farming is in our nature", desc: "Plant today - harvest tomorrow." },
            { name: "Road Trip", desc: "That thing wouldn't have fit onto the street anyway." },
            { name: "Plant get enough", desc: "A little help can go a long way." },
            { name: "The plot thickens", desc: "You won't rest until you've reached maximum efficiency." },
            { name: "Allez hopp", desc: "Oh, they can do THAT as well?" },
            { name: "You are not a kangaroo", desc: "Seriously, think of the poor animal!" },
            { name: "Giddy-up!", desc: "I could get used to getting around like thisâ€¦" },
            { name: "Thoroughbred!", desc: "I'm a real cowboy, mom!" },
            { name: "Help me to help you", desc: "Sure, I can take care of that, neighbour." },
            { name: "Helper A does not stop â€¦ ever", desc: "What do you mean 'take care of my own farm as well'?" },
            { name: "It's just the beginning", desc: "I've never felt happier than here." },
            { name: "Just a sprinkle", desc: "You have to think about the future." },
            { name: "It's sow easy", desc: "Planting one bean will yield much green." },
            { name: "Own use", desc: "Reap what you sow." },
            { name: "Large-scale supplier", desc: "These are the fruits of your labour." },
            { name: "Field Trip", desc: "One vehicle for all of your needs." },
            { name: "Long haul", desc: "In it for the long game, I see." },
            { name: "van Gogh", desc: "Look at Mr. Fancypants over there." },
            { name: "It just fell off", desc: "It was only a matter of timeâ€¦" },
            { name: "Fix me up", desc: "Seriously, you should consider a membership card." },
            { name: "Fluffiness", desc: "Building up my wool empire." },
            { name: "Three little piggiesâ€¦", desc: "You'll be amazed how much food they need." },
            { name: "Clucky Streak", desc: "Now that's a lot of Easter eggs." },
            { name: "Bringing in the Honey", desc: "Well you've been one busy bee, haven't you?" },
            { name: "Cowherd", desc: "Bet you didn't think they'd be that much work, right?" },
            { name: "I like to switch it up", desc: "We're slowly getting there." },
            { name: "This is just my weekend vehicle", desc: "Yes, I need each and every one of these." },
            { name: "Vehicle fleet", desc: "Ok, I might have a problemâ€¦" },
            { name: "I read Shakespeare and stuff", desc: "The first step of any farmer." },
            { name: "Highly cultivated", desc: "I'm a little proud of this one myself." },
            { name: "Ultimutt Pawesomeness", desc: "Who's a good boy?" },
            { name: "That's a wrap", desc: "What's in the bale?" },
            { name: "Gone but not for cotton", desc: "Where would you even store them?!" },
            { name: "Raisin the stakes", desc: "It's Californian gold!" },
            { name: "Olea europaea", desc: "It's a fruit, not a vegetable!" },
            { name: "Original grain", desc: "My horses are crazy for it." },
            { name: "Rock on", desc: "The path to success is paved with rocks." },
            { name: "You wood not believe it", desc: "Taking a leaf of absence." },
            { name: "I'm stumped", desc: "If a tree falls in a forest... does one hand clap?" },
            { name: "Hard work pays off", desc: "You know you can also spend it, right?" },
            { name: "All out of Land", desc: "Everything the light touches...is mine." },
            { name: "Well-Oiled Machine", desc: "Hmm, we could franchise thisâ€¦" },
            { name: "Pretty colourful", desc: "Childhood memories, brought back to your home." },
            { name: "Game on", desc: "I'm somewhat of a collector myself." },
            { name: "Cheese it", desc: "Anybody up for some fondue?" },
            { name: "It's never too late to farm", desc: "The journey begins." }
        ];

        const werewolfEarned = ["Help me to help you", "Ultimutt Pawesomeness", "Giddy-up!", "Allez hopp", "Well-Oiled Machine", "All out of Land", "You wood not believe it", "I'm stumped", "Farming is in our nature"];
        const rayEarned = ["Help me to help you", "Ultimutt Pawesomeness", "Giddy-up!", "Allez hopp", "Well-Oiled Machine", "All out of Land", "You wood not believe it", "I'm stumped", "Road Trip", "Plant get enough", "The plot thickens", "Helper A does not stop â€¦ ever", "It's just the beginning", "Just a sprinkle", "It's sow easy", "Own use", "Large-scale supplier", "Field Trip", "Long haul"];

        function renderTrophies(farmId, earnedList) {
            const container = document.getElementById(`f${farmId}-trophies`);
            const borderClass = farmId === 1 ? 'f1-border' : 'f2-border';
            let html = `<div class="card-inner pinned-contract"><b class="text-yellow-500 uppercase">Mission Contracts</b><br>Progress: 12 / 50 Completed</div>`;
            let eHtml = ""; let uHtml = "";
            trophyList.forEach(t => {
                const isE = earnedList.includes(t.name);
                const block = `<div class="card-inner ${borderClass} ${isE ? 'trophy-earned' : ''}"><b>${t.name}</b><br><span class="italic text-[9px] text-gray-400">${t.desc}</span><br>${isE ? '<span class="text-green-500 font-bold">[EARNED]</span>' : 'Progress: 0%'}</div>`;
                if (isE) eHtml += block; else uHtml += block;
            });
            container.innerHTML = html + uHtml + eHtml;
        }

        async function updateDashboard() {
            const ts = new Date().getTime();
            const fetchXml = async (fileName) => {
                try {
                    const r = await fetch(`${fileName}?v=${ts}`);
                    if (!r.ok) { console.error(`ðŸ”´ Missing: ${fileName}`); return null; }
                    return new DOMParser().parseFromString(await r.text(), "text/xml");
                } catch (e) { return null; }
            };

            try {
                const [farms, vehicles, placeables, career, farmland, missions, economy] = await Promise.all([
                    fetchXml('farms.xml'), fetchXml('vehicles.xml'), fetchXml('placeables.xml'), fetchXml('careerSavegame.xml'), fetchXml('farmland.xml'), fetchXml('missions.xml'), fetchXml('economy.xml')
                ]);

                if (!farms || !career) return;

                // 1. CALCULATE MONEY DIFFERENCE
                const totalMoney = parseInt(career.querySelector("statistics money")?.textContent || 0);
                let farm2Money = 0;
                
                Array.from(farms.getElementsByTagName("farm")).forEach(f => {
                    const id = f.getAttribute("farmId");
                    const money = parseInt(f.getAttribute("money") || 0);
                    if (id === "2") {
                        farm2Money = money;
                        document.getElementById("f2-head-money").innerText = "$" + money.toLocaleString();
                    }
                });
                
                // Werewolf (Farm 1) gets the remainder
                const farm1Money = totalMoney - farm2Money;
                document.getElementById("f1-head-money").innerText = "$" + (farm1Money > 0 ? farm1Money.toLocaleString() : "0");

                // Clear dynamic containers
                ['f1-fleet','f2-fleet','f1-animals','f2-animals','f1-prod','f2-prod','f1-attach','f2-attach','f1-fields','f2-fields','missions','stocks','all-coll','f1-pallets','f2-pallets'].forEach(id => {
                    if(document.getElementById(id)) document.getElementById(id).innerHTML = "";
                });

                if(vehicles) {
                    let vCounts = {1:0, 2:0};
                    Array.from(vehicles.getElementsByTagName("vehicle")).forEach(v => {
                        const fId = v.getAttribute("farmId"); if (fId !== "1" && fId !== "2") return;
                        const name = v.getAttribute("filename").split('/').pop().replace('.xml','');
                        const target = v.querySelector("consumer[type='fuel']") ? `f${fId}-fleet` : `f${fId}-attach`;
                        document.getElementById(target).innerHTML += `<div class="card-inner ${fId=='1'?'f1-border':'f2-border'}"><b>${name}</b></div>`;
                        if(v.querySelector("consumer[type='fuel']")) vCounts[fId]++;
                    });
                    document.getElementById('f1-v-count').innerText = vCounts[1];
                    document.getElementById('f2-v-count').innerText = vCounts[2];
                }

                if(placeables) {
                    Array.from(placeables.getElementsByTagName("placeable")).forEach(p => {
                        const fId = p.getAttribute("farmId"); if (fId !== "1" && fId !== "2") return;
                        const storage = p.querySelector("storage");
                        const animals = p.getElementsByTagName("animal");
                        if(storage || animals.length > 0) {
                            let displayName = p.getAttribute("templateName") || p.getAttribute("filename").split('/').pop().replace('.xml','');
                            let aHtml = `<div class="card-inner ${fId=='1'?'f1-border':'f2-border'}"><b class="text-white uppercase">${displayName}</b>`;
                            if(storage) Array.from(storage.getElementsByTagName("node")).forEach(node => {
                                const level = Math.round(parseFloat(node.getAttribute("fillLevel")));
                                if(level > 1) aHtml += `<div class="mt-1">${cleanLabel(node.getAttribute("fillType"))}: ${level.toLocaleString()} L</div>`;
                            });
                            document.getElementById(`f${fId}-animals`).innerHTML += aHtml + "</div>";
                        }
                    });
                }

                if(career) {
                    const fStr = career.querySelector("map foundHelpIcons")?.textContent || "";
                    document.getElementById('coll-found').innerText = (fStr.split('1').length - 1);
                    for(let i=0; i<50; i++) {
                        const found = fStr[i] === '1';
                        document.getElementById('all-coll').innerHTML += `<div class="py-1 ${found?'text-green-500':'text-red-400'}">#${i+1}: ${found?'FOUND':'MISSING'}</div>`;
                    }
                }

            } catch (e) { console.error("Sync Error", e); }
        }

        function updateClocks() {
            const n = new Date();
            document.getElementById('time-gnv').innerText = `ET: ` + n.toLocaleTimeString('en-US', { timeZone: 'America/New_York', hour: '2-digit', minute: '2-digit' });
            document.getElementById('time-flora').innerText = `CT: ` + n.toLocaleTimeString('en-US', { timeZone: 'America/Chicago', hour: '2-digit', minute: '2-digit' });
        }

        async function getRealWeather() {
            try {
                const gnv = await fetch('https://api.open-meteo.com/v1/forecast?latitude=29.6516&longitude=-82.3248&current_weather=true&temperature_unit=fahrenheit').then(r => r.json());
                const flora = await fetch('https://api.open-meteo.com/v1/forecast?latitude=38.6689&longitude=-88.4851&current_weather=true&temperature_unit=fahrenheit').then(r => r.json());
                document.getElementById('weather-gnv').innerText = `TEMP: ${Math.round(gnv.current_weather.temperature)}Â°F`;
                document.getElementById('weather-flora').innerText = `TEMP: ${Math.round(flora.current_weather.temperature)}Â°F`;
            } catch(e) {}
        }

        renderTrophies(1, werewolfEarned); renderTrophies(2, rayEarned);
        updateClocks(); setInterval(updateClocks, 10000);
        getRealWeather(); updateDashboard();
    </script>
</body>
</html>
